"undefined"==typeof console&&(console={log:function(){},debug:function(){}});var kolumbus=function(kolumbus){var rpc,$win=$(window),$doc=$(document),$body=$doc.find("body"),subscriptions={},__subscribe=function(events,cb,once){$.each(events.replace(/(\s)\s*/g,"$1").split(" "),function(idx,e){subscriptions[e]||(subscriptions[e]=[]),subscriptions[e].push({cb:cb,once:once})})};kolumbus.subscribe=function(e,cb){__subscribe(e,cb,!1)},kolumbus.subscribeOnce=function(e,cb){__subscribe(e,cb,!0)},kolumbus.publish=function(events){var args=Array.prototype.slice.call(arguments,1);$.each(events.replace(/(\s)\s*/g,"$1").split(" "),function(idx,e){for(var idx in subscriptions[e]){var obj=subscriptions[e][idx];obj.cb&&obj.cb.apply(this,args),obj.once&&subscriptions[e].splice(idx,1)}})},kolumbus.widget=function(name,fn){kolumbus[name]=fn($win,$doc)};var ajax=function(type,url,data,success){var progress=setTimeout(function(){$body.addClass("progress")},500);$.ajax({type:type,url:url,data:data,success:function(){clearTimeout(progress),$body.removeClass("progress"),success.apply(this,arguments)},error:function(){clearTimeout(progress),$body.removeClass("progress")}})};return kolumbus.get=function(url,data,success){"function"==typeof data&&(success=data,data={}),ajax("GET",url,data,success,!1)},kolumbus.post=function(url,data,success,sslurl){if(sslurl){console.log("make sslrequest");var sslready=function(){rpc.post(url,data,success)};rpc?sslready():rpc=kolumbus.sslbridge.consumer(sslurl,function(){sslready()})}else ajax("POST",url,data,success,!1)},kolumbus.start=function(){kolumbus.publish("kolumbus:ready",$doc)},$(window).on("load",function(){kolumbus.publish("kolumbus:load",$doc)}),kolumbus}("undefined"==typeof kolumbus?{}:kolumbus);$(function(){kolumbus.start()}),kolumbus.widget("contentsizer",function($win){var winheight,rulesStr,rulesStr2,body=document.body,styleDoc=document.getElementById("js_sizer_styles").sheet||document.styleSheets.js_sizer_styles,selector=".page",selector2=".stage + .page",resized=0,event="onorientationchange"in window?"orientationchange":"resize";$win.on(event,function(){winheight=Math.max(document.documentElement.clientHeight,window.innerHeight,$win.height(),300),rulesStr=["height: ",winheight,"px !important;\n"].join(""),rulesStr2=["margin-top: ",winheight,"px !important;\n"].join(""),styleDoc.insertRule?(styleDoc.cssRules.length&&(styleDoc.deleteRule(1),styleDoc.deleteRule(0)),styleDoc.insertRule([selector,"{",rulesStr,"}"].join(""),0),styleDoc.insertRule([selector2,"{",rulesStr2,"}"].join(""),1)):(styleDoc.cssRules&&styleDoc.cssRules.length&&styleDoc.removeRule(),styleDoc.addRule(selector,rulesStr),styleDoc.addRule(selector2,rulesStr2)),!resized&&$(body).addClass("resized")&&(resized=!0)}).trigger(event)}),kolumbus.widget("videoscaler",function($win){var getNode=function(elm){return document.getElementById(elm)},selector=".js_scale",resized=0;Videoscaler=function($vid){var slotwidth,slotheight,slotratio,rulesStr,width,height,visualratio=1280/720,jsScaleStyles="js_scale_styles",resize="resize",round=function(i){return parseInt(1e4*i,10)/1e4},styleDoc=getNode(jsScaleStyles).sheet||document.styleSheets[jsScaleStyles],$slot=$vid.parent();var resizer=function(){slotwidth=$slot.width(),slotheight=$slot.height(),slotratio=slotwidth/slotheight,visualratio>slotratio?(width=slotheight*visualratio,height=width/visualratio):(height=slotwidth/visualratio,width=height*visualratio),rulesStr=["width:",round(width),"px !important;","height:",round(height),"px !important;","margin: 0 0 0 ",round((width-slotwidth)/-2),"px;\n"].join(""),styleDoc.insertRule?(styleDoc.cssRules.length&&styleDoc.deleteRule(0),styleDoc.insertRule(selector+"{"+rulesStr+"}",0)):(styleDoc.cssRules&&styleDoc.cssRules.length&&styleDoc.removeRule(),styleDoc.addRule(selector,rulesStr))};$win.bind(resize,resizer).trigger(resize)},kolumbus.subscribe("kolumbus:ready",function($node){$node.find(selector).each(function(){new Videoscaler($(this))}),!resized&&kolumbus.publish("imagescaler:scaled")&&(resized=1)})});
